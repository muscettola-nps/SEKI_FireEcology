---
title: "ShortReburnIntervals"
author: "Isabella Muscettola"
date: "2026-02-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Loading Data and Libraries
```{r}
# install packages (if needed)
#install.packages("tidyverse", "Rtools", "dplyr", "knitr", "writexl", "ggplot2", "vegan", "patchwork")
#install.packages("patchwork")

#load packages
library(ggplot2)
library(tidyverse)
library(dplyr)
library(paletteer)
library(vegan)
library(patchwork)
library(stringr)
```

## Adjust File Paths 
```{r}
path_data <- "C:/Users/imuscettola/OneDrive - DOI/Captain_9/Data_Analysis/Data/ShrubShortReburn/"
path_figures <- "C:/Users/imuscettola/OneDrive - DOI/Captain_9/Data_Analysis/Figures/ShrubShortReburn/"
```

# Start Here!

## Load Tidied Data
```{r}
CoverPoints_data <- read.csv(paste0(path_data, "2_working/Points_data.csv"))
CoverPoints_header <- read.csv(paste0(path_data, "2_working/Points_header.csv"))
SpComp_data <- read.csv(paste0(path_data, "2_working/SpComp_data.csv"))
SpComp_header <- read.csv(paste0(path_data, "2_working/SpComp_header.csv"))
DensityBelts_data <- read.csv(paste0(path_data, "2_working/DensityBelts_data.csv"))
DensityBelts_header <- read.csv(paste0(path_data, "2_working/DensityBelts_header.csv"))
PostBurnSev_data <- read.csv(paste0(path_data, "2_working/PostBurnSev_data.csv"))
PostBurnSev_header <- read.csv(paste0(path_data, "2_working/PostBurnSev_header.csv"))
SpList <- read.csv(paste0(path_data, "2_working/SpList.csv"))
Points_summarybyspecies <- read.csv(paste0(path_data, "2_working/Points_summarybyspecies.csv"))
Points_summarybylifeform <- read.csv(paste0(path_data, "2_working/Points_summarybylifeform.csv"))
SpRichness_byPlotRead <- read.csv(paste0(path_data, "2_working/UniqueSpecies_byPlotRead.csv"))
Points_summarybyspeciesandstatus <- read.csv(paste0(path_data, "2_working/Points_summarybyspeciesandstatus.csv"))
Points_summarybylifeformandstatus <- read.csv(paste0(path_data, "2_working/Points_summarybylifeformandstatus.csv"))
```

## Data Summarizing by Veg Type
```{r}
# CEBE

## summary by lifeform
CEBE_summarybylifeform <- Points_summarybylifeform %>%
  filter(MonitoringType=="BCEBE")
## summary by lifeform and status
CEBE_summarybylifeformandstatus <- filter(Points_summarybylifeformandstatus, MonitoringType=="BCEBE")
## summary by species
CEBE_summarybyspecies <- Points_summarybyspecies %>%
  filter(MonitoringType=="BCEBE") %>%
  mutate(FireHistory = case_when(FireHistory=="Castle" ~ "Castle",
                                 FireHistory=="CoffeePot" ~ "CoffeePot",
                                 FireHistory=="Castle+CoffeePot"~"Castle and CoffeePot"))


## CEBE specific - summary by species and status
CEBE_summarybyspeciesandstatus <- Points_summarybyspeciesandstatus %>%
  filter(MonitoringType=="BCEBE")  %>%
  mutate(FireHistory = case_when(FireHistory=="Castle" ~ "Castle",
                                 FireHistory=="CoffeePot" ~ "CoffeePot",
                                 FireHistory=="Castle+CoffeePot"~"Castle and CoffeePot"))

```


## Initial Data Exploration

Species abundance per plot per read

```{r}
#change Year to factor so it graphs nicer
Points_summarybyspecies$Year <- as.factor(Points_summarybyspecies$Year)

ggplot(Points_summarybyspecies, aes(x=Year, y=perc_of_hits, fill=Species.Symbol), fill=Species.Symbol) +
  geom_col(position = "fill") + 
  facet_wrap(~MacroPlot.Name) +
  theme(axis.text.x=element_text(angle=45, vjust = 1, hjust=1, size=14), axis.title.x=element_text(size=20), axis.title.y=element_text(size=20),legend.title=element_text(size=14)) +
  labs(y="% Cover", fill="Species Symbol")
  

#save the figure to the S drive
#ggsave(paste0(path_figures, "SpeciesAbundancebyPlotandYear.png"), width = 14, height = 10, limitsize=FALSE)
```

There are so many species of plants it's hard to digest! Let's group and summarize by lifeform (i.e. shrub, tree, graminoid, etc.)

```{r}
Points_summarybylifeform$Year <- as.factor(Points_summarybylifeform$Year)

ggplot(Points_summarybylifeform, aes(x=Year, y=perc_of_hits, fill=Prf..Lifeform), fill=Prf..Lifeform) +
  geom_col(position = "fill") + 
  facet_wrap(~MacroPlot.Name) +
  theme(axis.text.x=element_text(angle=45, vjust = 1, hjust=1, size=14), axis.title.x=element_text(size=20), axis.title.y=element_text(size=20),legend.title=element_text(size=20), legend.text=element_text(size=14)) +
  labs(y="% Cover", fill="Cover Class") +
  scale_fill_paletteer_d("PrettyCols::Autumn")

#save the figure to the S drive
#ggsave(paste0(path_figures, "LifeformAbundancebyPlotandYear.png"), width = 14, height = 10, limitsize=FALSE)
```

## Tracking Shrub Abundance Across Time 

How has the abundance of shrubs changed across time, particularly with the occurrence of fire? 

NOTE: Fire Histories for each plot:
ADFA 12 & 22: 1998 (before 1998 plot read), 2021 (KNP)
ADFA 13 & 14: 1998, 2021 (KNP), 2024 (CoffeePot, before 2024 plot read)
CEBE 1-3: 2020 (Castle) only
CEBE 4-6: 2020 (Caste) + 2024 (CoffeePot)
CEBE 7-9: 2024 (CoffeePot) only

### Shrub % Cover across time
#### CEBE
```{r}
#Abundance of shrubs across time (Boxplot for CEBE plots & geom_point for ADFA plots)

#make sure Year is numeric
Points_summarybylifeform$Year <- as.numeric(Points_summarybylifeform$Year)

#boxplot
ggplot(CEBE_summarybylifeform[CEBE_summarybylifeform$Prf..Lifeform=="Shrub", ], aes(x=Monitoring.Status, y=perc_of_hits, fill=FireHistory)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(title='CEBE Plots - Shrub Cover', x='Monitoring Status', y='% Cover') +
  scale_x_discrete(limits= c("Re01Year05", "Re01Year01", "Re02Year01")) + 
  theme(axis.text.x=element_text(size=14), axis.title.x=element_text(size=20), axis.text.y=element_text(size=14), axis.title.y=element_text(size=20),legend.title=element_text(size=20), legend.text=element_text(size=14), plot.title=element_text(size=20, face="bold"))

#ggsave(paste0(path_figures, "CEBE_ShrubAbundancebyFireHistory_BoxPlot.png"), width = 8.5, height = 7, limitsize=FALSE)

```

```{r}
# looking at live vs dead shrub cover
ggplot(CEBE_summarybylifeformandstatus[CEBE_summarybylifeformandstatus$Prf..Lifeform=="Shrub", ], aes(x=FireHistory, y=perc_of_hits, fill=Status)) +
         geom_boxplot() +
         theme_bw() +
         labs(title="CEBE Plots - 2025 Shrub Cover", x="Fire History", y = "% Cover") +
         scale_x_discrete(limits= c("Castle", "CoffeePot", "Castle+CoffeePot")) + 
  theme(axis.text.x=element_text(size=14), axis.title.x=element_text(size=20), axis.text.y=element_text(size=14), axis.title.y=element_text(size=20),legend.title=element_text(size=20), legend.text=element_text(size=14), plot.title=element_text(size=20, face="bold")) +
  scale_fill_manual(values = c("D" = "#707070", "L" = "#008B00"), labels=c("D"="Dead", "L"="Live"))

#ggsave(paste0(path_figures, "CEBE_ShrubAbundancebyFireHistoryandStatus_BoxPlot.png"), width = 8.5, height = 7, limitsize=FALSE)
```


#### Lookout Point ADFA - needs to be fixed
```{r}
#HOLD - missing ADFA data from 2022 plot read - geom_point
#ADFA_summarybylifeform <- Points_summarybylifeform %>%
#  filter(MonitoringType =="BADFA1D04")
#ADFA_summarybylifeform$Year <- as.numeric(ADFA_summarybylifeform$Year)

#ggplot(ADFA_summarybylifeform[ADFA_summarybylifeform$Prf..Lifeform=="Shrub", ], aes(x=Year, y=perc_of_hits, color=FireHistory, group=MacroPlot.Name)) +
#  geom_point() + 
#  geom_line() +
#  geom_vline(xintercept = c(1997, 2021, 2023.9), linetype = "dashed", color="red") +
#  theme_bw() + 
#  labs(title='ADFA Plots - Shrub Cover', x='Monitoring Status', y='% Shrub Cover') + 
#  theme(axis.text.x=element_text(size=14), axis.title.x=element_text(size=20), axis.text.y=element_text(size=14), axis.title.y=element_text(size=20),legend.title=element_text(size=20), legend.text=element_text(size=14), plot.title=element_text(size=20, face="bold"))

#ggsave(paste0(path_figures, "ADFA_ShrubAbundancebyFireHistory_PointsPlot.png"), width = 8.5, height = 7, limitsize=FALSE)

```

### % Shrub Cover by Species
#### CEBE Plots
```{r}
#Bar Plot showing the abundance of Shrubs across time colored by Species and faceted by treatment

ggplot(CEBE_summarybyspecies[CEBE_summarybyspecies$Prf..Lifeform=="Shrub", ], aes(x=FireHistory, y=perc_of_hits, fill=Species.Symbol)) + 
  geom_boxplot() + 
  facet_wrap(~Species.Symbol) +
  labs(title="CEBE Plots - Shrub Abundance by Species", x="Fire History", y="% Cover") +
  scale_x_discrete(limits=c("Castle", "CoffeePot", "Castle and CoffeePot"), labels = function(x) gsub(" ", "\n", x)) + 
  theme(axis.text.x=element_text(size=14), axis.title.x=element_text(size=20), axis.text.y=element_text(size=14), axis.title.y=element_text(size=20), legend.title=element_text(size=20), legend.text=element_text(size=14), plot.title=element_text(size=20, face="bold"))

#ggsave(paste0(path_figures, "CEBE_ShrubAbundance_bySpecies_BoxPlot.png"), width = 11, height=9, limitsize=FALSE)

#Let's just look at CEBE (mountain mahogany occurence)- the most common shrub and found in all 3 fire histories
ggplot(CEBE_summarybyspecies[CEBE_summarybyspecies$Species.Symbol=="CEBE1", ], aes(x=FireHistory, y=perc_of_hits)) +
  geom_boxplot() + 
  theme_bw() +
  labs(title="CEBE Plots - Mountain Mahogany Abundance", x="Fire History", y="% Cover") +
  scale_x_discrete(limits=c("Castle", "CoffeePot", "Castle and CoffeePot"), labels = function(x) gsub(" ", "\n", x)) + 
  theme(axis.text.x=element_text(size=14), axis.title.x=element_text(size=20), axis.text.y=element_text(size=14), axis.title.y=element_text(size=20), legend.title=element_text(size=20), legend.text=element_text(size=14), plot.title=element_text(size=20, face="bold"))

#ggsave(paste0(path_figures, "CEBE_CEBEAbundance_BoxPlot.png"), width = 8, height=6, limitsize=FALSE)
```

### Shrub Cover by Species and Status
```{r}
# Let's look at all the shrub species separated by status (living and dead)
ggplot(CEBE_summarybyspeciesandstatus[CEBE_summarybyspeciesandstatus$Prf..Lifeform=="Shrub", ], aes(x=FireHistory, y=perc_of_hits, fill=Status)) + 
  geom_boxplot() + 
  facet_wrap(~Species.Symbol) +
  labs(title="CEBE Plots - Shrub Abundance by Species", x="Fire History", y="% Cover") +
  scale_x_discrete(limits=c("Castle", "CoffeePot", "Castle and CoffeePot"), labels = function(x) gsub(" ", "\n", x)) + 
  theme(axis.text.x=element_text(size=14), axis.title.x=element_text(size=20), axis.text.y=element_text(size=14), axis.title.y=element_text(size=20), legend.title=element_text(size=20), legend.text=element_text(size=14), plot.title=element_text(size=20, face="bold")) +
  scale_fill_manual(values = c("D" = "#707070", "L" = "#008B00"), labels=c("D"="Dead", "L"="Live"))

#ggsave(paste0(path_figures, "CEBE_ShrubAbundance_bySpeciesandStatus_BoxPlot.png"), width = 11, height=9, limitsize=FALSE)

#Now let's look only at CEBE by separate the living and the dead
ggplot(CEBE_summarybyspeciesandstatus[CEBE_summarybyspeciesandstatus$Species.Symbol=="CEBE1", ], aes(x=FireHistory, y=perc_of_hits, fill=Status)) +
  geom_boxplot() + 
  theme_bw() +
  labs(title="CEBE Plots - Mountain Mahogany Abundance", x="Fire History", y="% Cover") +
  scale_x_discrete(limits=c("Castle", "CoffeePot", "Castle and CoffeePot"), labels = function(x) gsub(" ", "\n", x)) + 
  theme(axis.text.x=element_text(size=14), axis.title.x=element_text(size=20), axis.text.y=element_text(size=14), axis.title.y=element_text(size=20), legend.title=element_text(size=20), legend.text=element_text(size=14), plot.title=element_text(size=20, face="bold")) +
  scale_fill_manual(values = c("D" = "#707070", "L" = "#008B00"), labels=c("D"="Dead", "L"="Live"))

#ggsave(paste0(path_figures, "CEBE_CEBEAbundancebyStatus_BoxPlot.png"), width = 8, height=6, limitsize=FALSE)
```

### All land cover types - shrubs, graminoid, undefined, etc.
#### CEBE
```{r}
a <- ggplot(CEBE_summarybylifeform[CEBE_summarybylifeform$FireHistory=="Castle", ], aes(x=MacroPlot.Name, y=perc_of_hits, fill=Prf..Lifeform), fill=Prf..Lifeform) +
  geom_col(position = "fill") + 
  facet_wrap(~FireHistory) +
  theme(axis.text.x=element_text(angle=45, vjust = 1, hjust=1, size=14), axis.title.x=element_text(size=20), axis.title.y=element_text(size=20),legend.title=element_text(size=20), legend.text=element_text(size=14), strip.text = element_text(size = 14), legend.position = "none") +
  labs(y="% Cover", fill="Cover Class") +
  scale_fill_manual(values=c("Forb/herb"="#774762FF", "Graminoid"="#BA6E1DFF", "Shrub"="#D6BB3BFF", "Tree"="#755028FF", "Undefined"="#585854FF", "Vine"="#205F4BFF"))

b <- ggplot(CEBE_summarybylifeform[CEBE_summarybylifeform$FireHistory=="Castle+CoffeePot", ], aes(x=MacroPlot.Name, y=perc_of_hits, fill=Prf..Lifeform), fill=Prf..Lifeform) +
  geom_col(position = "fill") + 
  facet_wrap(~FireHistory) +
  theme(axis.text.x=element_text(angle=45, vjust = 1, hjust=1, size=14), axis.title.x=element_text(size=20), axis.title.y=element_text(size=20),legend.title=element_text(size=20), legend.text=element_text(size=14), strip.text = element_text(size = 14), legend.position = "none") +
  labs(y="% Cover", fill="Cover Class") +
  scale_fill_manual(values=c("Forb/herb"="#774762FF", "Graminoid"="#BA6E1DFF", "Shrub"="#D6BB3BFF", "Tree"="#755028FF", "Undefined"="#585854FF", "Vine"="#205F4BFF"))

c <- ggplot(CEBE_summarybylifeform[CEBE_summarybylifeform$FireHistory=="CoffeePot", ], aes(x=MacroPlot.Name, y=perc_of_hits, fill=Prf..Lifeform), fill=Prf..Lifeform) +
  geom_col(position = "fill") + 
  facet_wrap(~FireHistory) +
  theme(axis.text.x=element_text(angle=45, vjust = 1, hjust=1, size=14), axis.title.x=element_text(size=20), axis.title.y=element_text(size=20),legend.title=element_text(size=20), legend.text=element_text(size=14), strip.text = element_text(size = 14), legend.position = "none") +
  labs(y="% Cover", fill="Cover Class") +
  scale_fill_manual(values=c("Forb/herb"="#774762FF", "Graminoid"="#BA6E1DFF", "Shrub"="#D6BB3BFF", "Tree"="#755028FF", "Undefined"="#585854FF", "Vine"="#205F4BFF"))

a + b + c
#ggsave(paste0(path_figures, "CEBE_LifeformAbundancebyPlotandFireHistory.png"), width = 8, height=6, limitsize=FALSE)

```

### Height of Shrubs colored by living or dead by fire history
```{r}
#if we want to make barplots 
```

